<!DOCTYPE html>
<html>
  <head>
    <title>Secure Blogging Website</title>
  </head>
  <body>
    <h1>Secure Blogging Application :)</h1>
    <h2>
      Welcome back:
      <script>
        // FOR DOCUMENT WRITE, CAN EXECUTE NEW SCRIPTS eg. <script>Malicous Code
        // var pos=document.URL.indexOf("context=")+8;
        var pos = document.URL.indexOf("context=") + 8;
        // console.log(decodeURIComponent(document.URL.substring(pos)))
        document.write(decodeURIComponent(document.URL.substring(pos)));
      </script>
    </h2>
    <h2>Create post:</h2>
    <form
      action="/post/create"
      method="POST"
      target="dummyframe"
      enctype="text/plain"
    >
      <label for="title">Title:</label><br />
      <input type="text" id="title" name="title" /><br /><br />
      <label for="content">Content:</label><br />
      <input type="text" id="content" name="content" /><br /><br />
      <input type="submit" value="Submit" />
    </form>
    <h2>All posts:</h2>
    <ul id="posts"></ul>
    <script>
      const ul = document.getElementById("posts");
      const container = document.createElement("div");
      const url = "/post";

      fetch(url)
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          let posts = data;

          posts.map(function (post) {
            let li = document.createElement("li");
            let title = document.createElement("h3");
            let content = document.createElement("p");

            li.insertAdjacentHTML("afterbegin", `<div>${post.content}</div>`);
            li.insertAdjacentHTML("afterbegin", `<h3>${post.title}</h3>`);

            li.appendChild(title);
            li.appendChild(content);
            container.appendChild(li);
          });
        })
        .catch(function (error) {
          console.log(error);
        });

      ul.appendChild(container);
    </script>
  </body>
  <iframe name="dummyframe" id="dummyframe" style="display: none"></iframe>
</html>
